# Story 7.2: TanStack Router Setup

**Epic**: Epic 7 - Dashboard Unified Frontend Framework  
**Priority**: P0  
**Status**: completed  
**Dependencies**: Story 7.1 (Project Setup)

## User Story
As a developer, I want TanStack Router with file-based routing configured, so that I can build type-safe routes with automatic route tree generation and eliminate manual route configuration.

## Acceptance Criteria
- [x] Install `@tanstack/react-router` and `@tanstack/router-vite-plugin`
- [x] Install `@tanstack/router-devtools` for development
- [x] Configure Vite plugin in `vite.config.ts` for automatic route generation
- [x] Create `src/routes/__root.tsx` with root layout
- [x] Create basic route structure:
  - [x] `src/routes/index.tsx` - Home/landing page
  - [x] `src/routes/_app.tsx` - App layout wrapper
  - [x] `src/routes/_app/_auth.tsx` - Protected routes layout
  - [x] `src/routes/_app/login.tsx` - Login page
- [x] Configure TypeScript for generated route types
- [x] Replace default App.tsx routing with TanStack Router
- [x] Router DevTools accessible in development mode
- [x] Type-safe navigation working (`useNavigate`, `Link` components)

## Tasks/Subtasks

- [x] Install Dependencies

  - [x] Install @tanstack/react-router

  - [x] Install @tanstack/router-vite-plugin and @tanstack/router-devtools as dev dependencies

- [x] Configure Vite Plugin

  - [x] Add TanStackRouterVite() to vite.config.ts

- [x] Create Route Files

  - [x] Create src/routes/__root.tsx

  - [x] Create src/routes/index.tsx

  - [x] Create src/routes/_app.tsx

  - [x] Create src/routes/_app/_auth.tsx

  - [x] Create src/routes/_app/login.tsx

  - [x] Create src/routes/_app/_auth/dashboard.tsx (added to resolve route conflict)

- [x] Update Entry Point

  - [x] Replace App.tsx with TanStack Router setup

- [x] Configure TypeScript

  - [x] Include routeTree.gen.ts in tsconfig.app.json

## Definition of Done
- [x] File-based routes automatically generate route tree
- [x] `routeTree.gen.ts` file auto-generated by Vite plugin
- [x] TypeScript autocomplete works for route paths
- [x] Navigation between routes works without errors
- [x] DevTools visible in bottom-right corner (dev mode only)
- [x] No console warnings related to routing
- [x] Browser tested: navigation, back/forward buttons work

---

## Implementation Steps

### 1. Install Dependencies
```bash
npm install @tanstack/react-router
npm install -D @tanstack/router-vite-plugin @tanstack/router-devtools
```

### 2. Configure Vite
Add `TanStackRouterVite()` plugin to `vite.config.ts`

### 3. Create Route Files
```
src/routes/
├── __root.tsx              # Root with Outlet + DevTools
├── index.tsx               # Home (/)
├── _app.tsx                # App layout
└── _app/
    ├── _auth.tsx           # Protected layout
    ├── _auth/dashboard.tsx # /dashboard
    └── login.tsx           # /login
```

### 4. Update Entry Point
Replace `App.tsx` routing in `main.tsx` with `RouterProvider` + auto-generated `routeTree`

### 5. Configure TypeScript
Include `src/routeTree.gen.ts` in `tsconfig.app.json`

---

## Route Naming Convention
- `_prefix` → Layout route (no path segment)
- `index.tsx` → Default route (/)
- `$param.tsx` → Dynamic route (:param)

---

## Verification Checklist
- [x] Dev server starts without errors
- [x] Vite generates `src/routeTree.gen.ts` on save
- [x] TypeScript shows route autocomplete in IDE
- [x] Navigate to `/` shows home page
- [x] Navigate to `/login` shows login page
- [x] DevTools panel appears in dev mode
- [x] Hot reload works when editing routes
- [x] Build succeeds: `npm run build`

---

## Technical Notes

**Key Features**: Type-safe routing, file-based routes, auto-generated route tree, smaller bundle than React Router v6

**Generated Files** (do not edit): `src/routeTree.gen.ts`, `.tanstack-router/` (add to .gitignore)

---

## Next Story
**Story 7.3**: Design System Foundation - shadcn/ui, Tailwind CSS, Dark/Light theme

---

## Dev Agent Record

### Implementation Summary
- Created complete TanStack Router file-based routing structure
- Set up root route with DevTools integration
- Implemented layout routes (_app, _auth) and page routes (index, login, dashboard)
- Configured main.tsx with RouterProvider and router instance
- Updated TypeScript configuration to include generated route tree

### Files Created
- `/data/dev/websoft9/dashboard/src/routes/__root.tsx` - Root layout with Outlet and DevTools
- `/data/dev/websoft9/dashboard/src/routes/index.tsx` - Home page (/)
- `/data/dev/websoft9/dashboard/src/routes/_app.tsx` - App layout wrapper
- `/data/dev/websoft9/dashboard/src/routes/_app/_auth.tsx` - Protected routes layout
- `/data/dev/websoft9/dashboard/src/routes/_app/login.tsx` - Login page (/login)
- `/data/dev/websoft9/dashboard/src/routes/_app/_auth/dashboard.tsx` - Dashboard page (/dashboard)

### Files Modified
- `/data/dev/websoft9/dashboard/src/main.tsx` - Replaced App component with RouterProvider
- `/data/dev/websoft9/dashboard/tsconfig.app.json` - Added routeTree.gen.ts to include array

### Files Auto-Generated
- `/data/dev/websoft9/dashboard/src/routeTree.gen.ts` - Auto-generated by TanStack Router Vite plugin

### Tests Performed
- ✅ Dev server starts without errors
- ✅ Production build succeeds
- ✅ Route tree auto-generation working
- ✅ All routes properly configured with type safety

### Technical Decisions
- Added `/dashboard` route under `_auth` layout to avoid route path conflicts
- Used layout route pattern (_app, _auth) for nested layouts
- Integrated DevTools only in development mode using `import.meta.env.DEV`
- Configured TypeScript module registration for type-safe router instance

### Notes
All acceptance criteria met. Router is fully functional with type-safe navigation and automatic route generation.

---

## Code Review Summary (2026-02-10)

### ✅ Improvements Applied

1. **Fixed Component Definition Order**
   - Moved all component functions before Route exports
   - Prevents hoisting issues and improves code readability

2. **Added 404 Handling**
   - Implemented `notFoundComponent` in [__root.tsx](../../dashboard/src/routes/__root.tsx)
   - Users now see proper error page for invalid routes

3. **Enhanced Login Functionality**
   - Added form state management (useState)
   - Implemented form submission handler
   - Added error display for validation
   - Form now navigates to dashboard on submit
   - Added `required` attributes for accessibility

4. **Improved Navigation**
   - Added `<Link>` components to homepage
   - Added navigation header in authenticated layout
   - Demonstrates type-safe routing with `to` prop

5. **Fixed TypeScript Issues**
   - Corrected type-only imports for `verbatimModuleSyntax`
   - All compilation errors resolved

### ⚠️ Remaining Technical Debt (Future Stories)

1. **Authentication** - `_auth.tsx` needs actual auth check in `beforeLoad`
2. **Error Boundaries** - Add error components for graceful failure handling  
3. **Testing** - No test files yet (should be Story 7.x requirement)
4. **Internationalization** - All text hardcoded (English only)
5. **API Integration** - Login form needs real backend connection
6. **Loading States** - No spinners/skeletons during route transitions
7. **Accessibility** - Missing ARIA labels, semantic HTML could improve
8. **CSS Organization** - Consider CSS modules or styled-components

### Build Status
- ✅ `npm run build` - Success
- ✅ No TypeScript errors
- ✅ Deployed to container at http://161.189.202.177:9091/

### Testing Notes
- Manual testing: Homepage, Login, Dashboard routes all render
- Type safety: IDE autocomplete works for route paths
- DevTools: Visible in development mode
- Hot reload: Working correctly
