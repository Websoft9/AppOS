# Sprint Change Proposal â€” Epic 9: Files â†’ Space Rebrand

**Date**: 2026-02-24
**Trigger**: Product concept correction â€” "Files" misrepresents the feature's business purpose
**Scope**: Moderate â€” rename/rebrand only; all technical implementation unchanged
**Proposed by**: PM (CC Workflow)

---

## Section 1: Issue Summary

The current Epic 9 feature is named "Files" / "User Files" at every layer â€” API paths, UI labels, route paths, and documentation. However, the feature's actual business purpose is a **per-user isolated private workspace**, not a generic file manager.

The name "Files" creates a conceptual mismatch:
- Users may expect a system-wide or shared file manager
- The feature is closer in concept to a "private space" or "personal workspace"
- Competitors with similar features use terms like "My Space", "Workspace", "Private Storage"

**Decision**: Rename the public-facing identity to **"Space"** (private space) across API paths, frontend routes, UI text, and documentation. The underlying PocketBase collection (`user_files`) and all database/migration logic remain **unchanged**.

---

## Section 2: Impact Analysis

### Story Status at Time of Change

| Story | Title | Status |
|-------|-------|--------|
| 9.1 | Backend Collection + Migration + Hooks | âœ… Done |
| 9.2 | File List UI | âœ… Done |
| 9.3 | Online Editor | âœ… Done |
| 9.4 | Share | âœ… Done |
| 9.5 | Settings UI (Admin) | âœ… Resolved by Epic 13 |
| 9.6 | File Version History | ðŸ“‹ Planned (not started) |

### Impact by Layer

| Layer | Impacted | Scope |
|-------|----------|-------|
| PocketBase Collection (`user_files`) | âŒ No change | Internal name, not user-facing |
| Database Migrations | âŒ No change | Data model unchanged |
| Hook Logic (`hooks.go`) | âœ… Yes | Constant name prefix change only |
| Backend Route Registration (`files.go`) | âœ… Yes | API path + function names |
| Backend Settings Key (`"files/quota"`) | âœ… Yes | Settings group key rename |
| Frontend Route File | âœ… Yes | File renamed + route path |
| Frontend Sidebar Navigation | âœ… Yes | Label + href |
| Frontend API Calls | âœ… Yes | All `/api/ext/files/` references |
| Frontend UI Text | âœ… Yes | Page title, dialog labels |
| i18n Locale Files | âœ… Yes | Any "Files" keys |
| Epic 9 Documentation | âœ… Yes | API paths, route paths, epic title |
| Story Files (9.1â€“9.6) | âœ… Yes | Terminology update |
| `routeTree.gen.ts` | âœ… Yes | Auto-generated; regenerated by TanStack Router |

### No-Change Guarantee

The following are explicitly **out of scope** for this change:
- PocketBase collection name `user_files`
- All migration files (1740300000â€“1740300003)
- Field names: `owner`, `name`, `content`, `mime_type`, `is_folder`, `parent`, `share_token`, `share_expires_at`, `size`
- All business logic (quota enforcement, hooks, share expiry)
- All acceptance criteria of completed stories

---

## Section 3: Recommended Approach

**Direct Adjustment** â€” modify affected artifacts without rollback or scope reduction.

Rationale:
- All 4 completed stories (9.1â€“9.4) are self-contained; the rename does not invalidate any acceptance criteria
- Story 9.6 is not started, so there is zero rework cost there
- The change touches only surface naming â€” no architectural patterns change
- Risk is low; all changes are textual/structural renames with zero logic impact

**Effort estimate**: Small â€” half-day implementation, primarily mechanical find-and-replace with targeted file renames.
**Risk**: Low â€” no business logic altered; regression risk limited to UI navigation and API path correctness.
**Timeline impact**: None on current sprint; can be applied as a one-shot patch.

---

## Section 4: Detailed Change Proposals

### 4.1 Backend â€” `backend/internal/routes/files.go`

**File rename**: Keep filename as `files.go` (internal implementation name, no user impact). Only content changes.

**OLD â†’ NEW: Route group**
```go
// OLD
f := g.Group("/files")

// NEW
f := g.Group("/space")
```

**OLD â†’ NEW: Public share routes**
```go
// OLD
pub := se.Router.Group("/api/ext/files/share")

// NEW
pub := se.Router.Group("/api/ext/space/share")
```

**OLD â†’ NEW: Constants prefix** (rename for internal consistency â€” optional but recommended)
```go
// OLD
filesMaxSizeMB          = 10
filesMaxPerUser         = 100
filesShareMaxMin        = 60
filesShareDefaultMin    = 30
filesAllowedUploadFormats = "..."
filesEditableFormats      = "..."
filesReservedFolderNames  = "deploy,artifact"

// NEW
spaceMaxSizeMB          = 10
spaceMaxPerUser         = 100
spaceShareMaxMin        = 60
spaceShareDefaultMin    = 30
spaceAllowedUploadFormats = "..."
spaceEditableFormats      = "..."
spaceReservedFolderNames  = "deploy,artifact"
```

**OLD â†’ NEW: Function names**
```go
// OLD
func registerFileRoutes(...)
func handleFilesQuota(...)

// NEW
func registerSpaceRoutes(...)
func handleSpaceQuota(...)
```

**OLD â†’ NEW: Settings group key**
```go
// OLD
settings.GetGroup(e.App, "files", "quota", defaultFilesQuota)

// NEW
settings.GetGroup(e.App, "space", "quota", defaultSpaceQuota)
```

---

### 4.2 Backend â€” `backend/internal/hooks/hooks.go`

Update any constant references from `files*` prefix to `space*` prefix (only if constants are referenced from here; otherwise no change needed if they are local to `files.go`).

> **Verify**: Confirm whether `filesMaxPerUser`, `filesReservedFolderNames`, etc. are imported from `routes` package or redefined in `hooks.go`. If redefined, apply same rename.

---

### 4.3 Backend â€” `backend/internal/routes/routes.go` or main registration

**OLD**
```go
registerFileRoutes(g, se)
```

**NEW**
```go
registerSpaceRoutes(g, se)
```

---

### 4.4 Backend â€” Settings key migration concern

The settings group key `"files/quota"` is used by `settings.go` as a fallback key. This key is also referenced in Epic 13 (Story 13.2 + 13.4). 

**Action required**: Coordinate with Epic 13 stories to update the settings key from `"files/quota"` â†’ `"space/quota"`. If Story 13.2/13.4 are already done, update the stored key via a settings migration or a one-time update script.

---

### 4.5 Frontend â€” Route file rename

```
OLD: dashboard/src/routes/_app/_auth/files.tsx
NEW: dashboard/src/routes/_app/_auth/space.tsx
```

Inside the file:

**OLD â†’ NEW: Route definition**
```tsx
// OLD
export const Route = createFileRoute('/_app/_auth/files')({

// NEW
export const Route = createFileRoute('/_app/_auth/space')({
```

**OLD â†’ NEW: API calls**
```tsx
// OLD
fetch('/api/ext/files/quota', ...)
fetch(`/api/ext/files/share/${shareFile.id}`, ...)
buildPublicShareUrl(`/api/ext/files/share/${file.share_token}/download`)

// NEW
fetch('/api/ext/space/quota', ...)
fetch(`/api/ext/space/share/${shareFile.id}`, ...)
buildPublicShareUrl(`/api/ext/space/share/${file.share_token}/download`)
```

**OLD â†’ NEW: UI text**
```tsx
// OLD
<h2 className="text-2xl font-bold shrink-0">Files</h2>

// NEW
<h2 className="text-2xl font-bold shrink-0">Space</h2>
```

Note: PocketBase collection calls `pb.collection('user_files')` remain **unchanged**.

---

### 4.6 Frontend â€” Sidebar navigation

File: `dashboard/src/components/layout/Sidebar.tsx`

**OLD**
```tsx
{ id: "files", label: "Files", icon: <FolderOpen className="h-5 w-5" />, href: "/files" },
```

**NEW**
```tsx
{ id: "space", label: "Space", icon: <FolderOpen className="h-5 w-5" />, href: "/space" },
```

---

### 4.7 Frontend â€” `routeTree.gen.ts`

This file is auto-generated by TanStack Router. It will regenerate automatically when the route file is renamed and the dev server restarts. No manual edit needed â€” verify after rename.

---

### 4.8 i18n Locale Files

Files: `dashboard/src/locales/en/common.json`, `dashboard/src/locales/zh/common.json`

Search for any keys containing "files", "Files", "file manager" and update:
- Key names: `files.*` â†’ `space.*`
- Display values: "Files" â†’ "Space" (EN), "æ–‡ä»¶" / "æ–‡ä»¶ç®¡ç†" â†’ "ç©ºé—´" / "ç§æœ‰ç©ºé—´" (ZH)

> **Note**: If the UI text is currently hardcoded in `files.tsx` rather than using i18n keys, this step may be minimal or not required.

---

### 4.9 Epic 9 Documentation

File: `specs/implementation-artifacts/epic9-files.md`

| Section | Old | New |
|---------|-----|-----|
| Title | `# Epic 9: User Files` | `# Epic 9: User Space` |
| API paths | `/api/ext/files/*` | `/api/ext/space/*` |
| Frontend route | `/_app/_auth/files` â†’ `/files` | `/_app/_auth/space` â†’ `/space` |
| Quota constant keys | `filesMaxSizeMB`, etc. | `spaceMaxSizeMB`, etc. |
| Overview description | "private file workspace" | "private space" |

---

## Section 5: Implementation Handoff

**Classification**: Moderate â€” involves multi-file rename across backend and frontend, plus documentation updates.

### Handoff to Dev Agent

**Recommended execution order**:
1. Update `backend/internal/routes/files.go` â€” route paths, constant names, function names
2. Update `backend/internal/hooks/hooks.go` â€” constant references (if any)
3. Rename `dashboard/src/routes/_app/_auth/files.tsx` â†’ `space.tsx` and update contents
4. Update `dashboard/src/components/layout/Sidebar.tsx`
5. Update i18n locale files
6. Restart dev server â†’ verify `routeTree.gen.ts` regenerates correctly
7. Update `specs/implementation-artifacts/epic9-files.md`
8. Coordinate settings key change with Epic 13 stories (Story 13.2 / 13.4)

### Success Criteria

- [ ] `GET /api/ext/space/quota` returns quota data (old `/api/ext/files/quota` returns 404)
- [ ] `POST /api/ext/space/share/{id}` creates share token
- [ ] `GET /api/ext/space/share/{token}/download` streams file (no auth)
- [ ] Frontend navigates to `/space` from sidebar; `/files` returns 404
- [ ] Page title shows "Space" not "Files"
- [ ] File upload, create, edit, delete, share all work as before
- [ ] `pb.collection('user_files')` calls remain unmodified and functional
- [ ] No broken references in `routeTree.gen.ts`

---

*This proposal is scoped as a pure rename/rebrand with zero business logic change. All acceptance criteria from Stories 9.1â€“9.4 remain valid and do not require re-verification beyond the success criteria above.*
